# MBus Release 04p2g

## Sample Directory

This directory contains an example for building a chip with MBus.
This example is one of the chips recently taped-out by the University 
of Michigan (September 2017) in TSMC 90nm technology, called FLPv3L.

This example does not contain all files required for completing the
chip netlist and simulation suite. However, it contains all necessary
information about MBus modules and their connections. Also, the verilog
testbench shows how to use the provided MBus Verilog files in your
top-level Verilog testbench.

## Directory Structure

verilog: Behavioral and structural verilog files. `FLPv3L.v` is the
         top-level verilog. Some verilog files are missing. For example,
         `FLPv3L_CTRL.v` is not included although `FLPv3L_CTRL` is 
         instantiated in the top-level (`FLPv3L`), because these are
         not related to the MBus implementation.

vsim: Verilog testbench files. `Makefile` is provided for reference. In 
        `Makefile`, `MBUSTB_DIR` must point to the `mbus_testbench`
        directory under the MBus release directory. `FLPv3L_test.v` is
        the top testbench, which instantiates all sub-modules and 
        testbenches.

## What to Do When Building a Testbench

* Instantiate `mbus_master_wrapper_testbench` when you want to add a 
  master-layer. Instantiate `mbus_member_wrapper_testbench` when you 
  want to add a member-layer.

* If your DUT is not a master-layer, you MUST instantiate
  `mbus_master_wrapper_testbench`.

* `mbus_master_wrapper_testbench` requires a separate clock signal,
  which is fed into `CLK_MBC` output. This is the MBus clock signal.

* `mbus_master_wrapper_testbench` and `mbus_member_wrapper_testbench`
  require a global reset signal, which should be connected to `RESETn`
  input. This is an active-low signal. Inside the DUT (`FLPv3L` in this
  example), this global reset signal is generated by a reset detector
  called `RSTDTCTRG_DUAL_TSMC90`.

* `mbus_master_wrapper_testbench` and `mbus_member_wrapper_testbench`
  requires `RX_ACK` to be implemented separately. See `N_M_RX_ACK` and
  `N_A_RX_ACK` generation in `FLPv3L_test.v`.

* You can generate and send MBus messages using `TX_REQ` signal in
  either `mbus_master_wrapper_testbench` or `mbus_member_wrapper_testbench`.
  See `send_MBus` and other tasks in `FLPv3L_task.v`

* `mbus_snooper` is a debugging tool, which displays on the terminal every 
  MBus messages sent/received. This does not affect the functionality of
  other master- or member-layers.
